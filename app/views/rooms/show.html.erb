<%# app/views/rooms/show.html.erb %>

<div
  class="container py-5"
  data-controller="shiritori"
  data-shiritori-room-id-value="<%= @room.id %>"
  data-shiritori-started-at-value="<%= @room.started_at&.iso8601 %>"
  data-shiritori-current-user-id-value="<%= current_user&.id %>"
  data-shiritori-current-guest-id-value="<%= guest_user? ? current_guest_id : '' %>"
  data-shiritori-current-participant-id-value="<%= @words.first&.room_participant_id %>"
>
  <div id="countdown-area" class="text-center py-5 fs-1 fw-bold">3</div>
  <div id="game-area" style="display:none;">

  <div class="card text-center mb-3">
    <div class="card-body">
      <h3 class="card-title">
        プレイヤー:
        <% if guest_user? %>
          <%= cookies.encrypted[:guest_name] %>
        <% else %>
          <%= current_user.username %>
        <% end %>
      </h3>
      <small class="text-muted">あなた専用のしりとり画面です</small>
    </div>
  </div>

  <div class="card text-center mb-4">
    <div class="card-body">
      <h2 class="card-title">残り時間</h2>
      <h1 class="red" data-shiritori-target="timer">30</h1>
    </div>
  </div>

  <div class="card mb-4 text-start">
    <div class="card-header fw-bold">あなたの単語履歴</div>
    <div class="card-body" id="word-history" style="height: 200px; overflow-y: scroll;">
      <% @words.each do |word| %>
        <%= render 'words/word', word: word %>
      <% end %>
    </div>
  </div>

  <div id="game-over-message" class="alert alert-info text-center fs-4 d-none">
    ゲーム終了！時間終了まで待機してください...
  </div>

  <div id="flash-messages">
    <%# ここに警告メッセージが表示されます %>
  </div>

    <%# ▼▼▼ ここを修正 ▼▼▼ %>
    <%# フォームに current_participant を渡す %>
    <%= render "rooms/word_form", room: @room, current_participant: @current_participant %>
    <%# ▲▲▲ ここを修正 ▲▲▲ %>
  </div>

</div>