<%# app/views/rooms/result.html.erb %>

<div
  class="container py-5 text-center"
  data-controller="result"
  data-result-room-id-value="<%= @room.id %>"
  data-result-current-user-id-value="<%= current_user&.id %>"
  data-result-current-guest-id-value="<%= guest_user? ? current_guest_id : '' %>"
  <%# ▼▼▼ レビュー指摘箇所を修正 ▼▼▼ %>
  <%# h()ヘルパーでエスケープ処理を追加して、安全にJSONデータを埋め込む %>
  data-result-initial-value="<%= h(@initial_results_data) %>"
  <%# ▲▲▲ レビュー指摘箇所を修正 ▲▲▲ %>
>
  <h1 class="mb-4">ゲーム結果</h1>

  <div data-result-target="resultsWrapper">
    <div id="initial-loading-message" class="alert alert-info mb-4">
      AI判定中...
      <div class="spinner-border spinner-border-sm ms-2" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    
    <div class="ranking-container" data-result-target="rankingContainer">
      <%# JavaScriptが、まず上記の初期データを読み込んでここに初回表示を行います %>
    </div>
  </div>

  <div class="mt-4">
    <%= button_to "トップに戻る", authenticated_root_path, method: :get, class: 'game-btn' %>
  </div>
</div>