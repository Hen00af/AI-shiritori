<div class="container py-5 text-center">
  <h1 class="mb-4">„Ç≤„Éº„É†ÁµêÊûú</h1>

  <!-- ÂãùËÄÖÁô∫Ë°® -->
  <% if @winner %>
    <div class="alert alert-success mb-4">
      <h2>üèÜ 1‰Ωç: <%= @winner.username %> üèÜ</h2>
    </div>
  <% end %>

  <!-- È†Ü‰ΩçË°®Á§∫ -->
  <div class="ranking-container">
    <% @ranked_results.each do |ranking_data| %>
      <div class="row justify-content-center mb-4">
        <div class="col-md-8">
          <div class="card <%= 'border-warning shadow-lg' if ranking_data[:rank] == 1 %> <%= 'border-primary' if ranking_data[:is_current_user] %>">

            <!-- È†Ü‰Ωç„Å®„É¶„Éº„Ç∂„ÉºÂêç„ÅÆ„Éò„ÉÉ„ÉÄ„Éº -->
            <div class="card-header d-flex align-items-center justify-content-between
                        <%= 'bg-warning text-dark fw-bold' if ranking_data[:rank] == 1 %>
                        <%= 'bg-primary text-white' if ranking_data[:is_current_user] && ranking_data[:rank] != 1 %>
                        <%= 'bg-secondary text-white' if !ranking_data[:is_current_user] && ranking_data[:rank] != 1 %>">

              <div class="d-flex align-items-center">
                <!-- È†Ü‰ΩçË°®Á§∫ -->
                <span class="badge
                           <%= 'bg-dark text-warning' if ranking_data[:rank] == 1 %>
                           <%= 'bg-light text-primary' if ranking_data[:rank] != 1 %>
                           fs-5 me-3">
                  <%= ranking_data[:rank] %>‰Ωç
                </span>

                <!-- „É¶„Éº„Ç∂„ÉºÂêç -->
                <h4 class="mb-0">
                  <%= ranking_data[:user].username %>
                  <%= ' („ÅÇ„Å™„Åü)' if ranking_data[:is_current_user] %>
                </h4>
              </div>

              <!-- 1‰Ωç„ÅÆÂ†¥Âêà„ÅØÁéãÂÜ†„Ç¢„Ç§„Ç≥„É≥ -->
              <% if ranking_data[:rank] == 1 %>
                <span class="fs-2">üëë</span>
              <% end %>
            </div>

            <!-- „Çπ„Ç≥„Ç¢Ë°®Á§∫ -->
            <div class="card-body text-center">
              <div class="row">
                <div class="col-md-4">
                  <h3 class="display-5 fw-bold
                           <%= 'text-warning' if ranking_data[:rank] == 1 %>
                           <%= 'text-primary' if ranking_data[:rank] != 1 %>">
                    <%= ranking_data[:result][:total_score] %>
                  </h3>
                  <small class="text-muted">Á∑èÂêà„Çπ„Ç≥„Ç¢</small>
                </div>

                <div class="col-md-4">
                  <h5 class="text-secondary"><%= ranking_data[:result][:total_base_score] %></h5>
                  <small class="text-muted">Âü∫Á§éÁÇπ</small>
                </div>

                <div class="col-md-4">
                  <h5 class="text-info"><%= ranking_data[:result][:total_ai_score] %></h5>
                  <small class="text-muted">AI„Éú„Éº„Éä„Çπ</small>
                </div>
              </div>

              <div class="mt-3">
                <span class="badge bg-light text-dark fs-6">
                  ‰ΩøÁî®ÂçòË™ûÊï∞: <%= ranking_data[:result][:word_count] %>ÂÄã
                </span>
              </div>
            </div>

            <!-- ÂçòË™ûÂ±•Ê≠¥Ôºà„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Ôºâ -->
            <div class="card-footer">
              <div class="accordion" id="wordsAccordion<%= ranking_data[:rank] %>">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapse<%= ranking_data[:rank] %>"
                            aria-expanded="false">
                      <i class="bi bi-list-ul me-2"></i>
                      ÂçòË™ûÂ±•Ê≠¥„ÇíË¶ã„Çã
                    </button>
                  </h2>
                  <div id="collapse<%= ranking_data[:rank] %>"
                       class="accordion-collapse collapse"
                       data-bs-parent="#wordsAccordion<%= ranking_data[:rank] %>">
                    <div class="accordion-body" style="max-height: 300px; overflow-y: auto;">
                      <% ranking_data[:result][:words].each do |word| %>
                        <%= turbo_frame_tag "word_evaluation_#{word.id}" do %>
                          <div class="d-flex justify-content-between align-items-center mb-2 border-bottom pb-2">
                            <p class="fs-6 mb-0 text-start fw-medium"><%= word.body %></p>
                            <div class="text-end">
                              <% if word.score.to_i > 0 %>
                                <span class="badge bg-secondary rounded-pill">Âü∫Á§é: <%= word.score %>ÁÇπ</span>
                                <% if word.ai_score.present? %>
                                  <span class="badge bg-info rounded-pill">AI: <%= word.ai_score %>ÁÇπ</span>
                                <% else %>
                                  <span class="badge bg-light text-dark rounded-pill">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                      <span class="visually-hidden">Loading...</span>
                                    </div>
                                  </span>
                                <% end %>
                              <% else %>
                                <span class="badge bg-light text-muted rounded-pill">ÈñãÂßãÂçòË™û</span>
                              <% end %>
                            </div>
                          </div>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-4">
    <%= button_to "„Éà„ÉÉ„Éó„Å´Êàª„Çã", authenticated_root_path, method: :get, class: 'game-btn' %>
  </div>
</div>
